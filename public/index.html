<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <meta name="description" content="An environment for the LC-3" />

    <meta name="theme-color" content="#272635" />

    <link
      rel="dns-prefetch"
      href="https://static.pyxxilated.studio"
      crossorigin="anonymous"
    />
    <link
      rel="dns-prefetch"
      href="https://api.pyxxilated.studio"
      crossorigin="anonymous"
    />

    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://static.pyxxilated.studio/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://static.pyxxilated.studio/images/favicon-16x16.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="https://static.pyxxilated.studio/images/apple-touch-icon.png"
    />

    <link
      rel="manifest"
      href="https://static.pyxxilated.studio/site.webmanifest"
    />

    <title>Little Computer Environment</title>

    <link
      rel="stylesheet"
      href="https://static.pyxxilated.studio/css/styles.css"
      media="all"
    />

    <link rel="stylesheet" href="styles.css" media="all" />

    <link
      rel="canonical"
      href="https://projects.pyxxilated.studio/little-env"
    />

    <script type="module">
      /**
       * Pressing the TAB key in a text area makes it lose focus and move to the next component, but
       * if we want people to write code, then they'll possibly use a TAB. So, let's enable it selectively.
       */
      let et = (id) => {
          let el = document.getElementById(id);
          el.onkeydown = (ev) => {
            let key = ev.keyCode
              ? ev.keyCode
              : ev.charCode
              ? ev.charCode
              : ev.which;
            if (key != 9 || ev.shiftKey || ev.ctrlKey || ev.altKey) {
              return true;
            }
            let st = el.scrollTop;
            if (el.setSelectionRange) {
              let ss = el.selectionStart,
                se = el.selectionEnd;
              el.value = el.value.substring(0, ss) + "\t" + el.value.substr(se);
              el.setSelectionRange(ss + 1, ss + 1);
              el.focus();
            } else if (el.createTextRange) {
              document.selection.createRange().text = "\t";
              ev.returnValue = false;
            }
            el.scrollTop = st;
            ev.prevDefault && ev.prevDefault();
            return false;
          };
        },
        TLN = {
          evl: {},
          uln: (e, t) => {
            let n = e.value.split("\n").length - t.children.length;
            if (n > 0) {
              let e = document.createDocumentFragment();
              for (; n > 0; ) {
                let t = document.createElement("span");
                (t.className = "tln-line"), e.appendChild(t), (n -= 1);
              }
              t.appendChild(e);
            }
            for (; n < 0; ) {
              t.removeChild(t.lastChild), (n += 1);
            }
          },
          aln: (e) => {
            let t = document.getElementById(e);
            if (null == t) {
              return console.warn("Couldn't find '" + e + "'");
            }
            let n = document.createElement("div");
            (n.className = "tln-wrapper"),
              t.parentNode.insertBefore(n, t),
              TLN.uln(t, n),
              (TLN.evl[e] = []);
            let l = ["propertychange", "input", "keydown", "keyup"],
              o = ((e, t) => (n) => {
                ((10 != +e.scrollLeft ||
                  (37 != n.keyCode &&
                    37 != n.which &&
                    "ArrowLeft" != n.code &&
                    "ArrowLeft" != n.key)) &&
                  36 != n.keyCode &&
                  36 != n.which &&
                  "Home" != n.code &&
                  "Home" != n.key &&
                  13 != n.keyCode &&
                  13 != n.which &&
                  "Enter" != n.code &&
                  "Enter" != n.key &&
                  "NumpadEnter" != n.code) ||
                  (e.scrollLeft = 0),
                  TLN.uln(e, t);
              })(t, n);
            for (let n = l.length - 1; n >= 0; n -= 1) {
              t.addEventListener(l[n], o, { passive: !0 }),
                TLN.evl[e].push({ evt: l[n], hdlr: o });
            }
            let r = ["change", "mousewheel", "scroll"],
              s = ((e, t) => (_) => (t.scrollTop = e.scrollTop))(t, n);
            for (let n = r.length - 1; n >= 0; n -= 1) {
              t.addEventListener(r[n], s, { passive: !0 }),
                TLN.evl[e].push({ evt: r[n], hdlr: s });
            }
          },
        };

      // Lazy load some stuff
      (async () => {
        const module = await import("./lce.js");
        await module.default();
        et("code-area");
        TLN.aln("code-area");
      })();
    </script>
  </head>
  <body></body>
</html>
