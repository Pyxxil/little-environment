<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <meta name="description" content="An environment for the LC-3" />

    <meta name="theme-color" content="#1a1423" />

    <link rel="icon" href="/static/images/favicon.ico" />
    <link rel="apple-touch-icon" href="/static/images/apple-touch-icon.png" />

    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="/static/site.webmanifest" />

    <title>Little Computer Environment</title>

    <link
      rel="stylesheet"
      href="https://unpkg.com/purecss@2.0.3/build/pure-min.css"
      integrity="sha384-cg6SkqEOCV1NbJoCu11+bm0NvBRc8IYLRGXkmNrqUBfTjmMYwNKPWBTIKyw9mHNJ"
      crossorigin="anonymous"
      media="none"
      onload="if(media!='all')media='all'"
    />
    <noscript>
      <link
        rel="stylesheet"
        href="https://unpkg.com/purecss@2.0.3/build/pure-min.css"
        integrity="sha384-cg6SkqEOCV1NbJoCu11+bm0NvBRc8IYLRGXkmNrqUBfTjmMYwNKPWBTIKyw9mHNJ"
        crossorigin="anonymous"
      />
    </noscript>

    <link
      rel="stylesheet"
      href="https://unpkg.com/purecss@2.0.3/build/grids-responsive-min.css"
      media="none"
      onload="if(media!='all')media='all'"
    />
    <noscript>
      <link
        rel="stylesheet"
        href="https://unpkg.com/purecss@2.0.3/build/grids-responsive-min.css"
      />
    </noscript>

    <link
      rel="stylesheet"
      href="https://www.pyxxilated.studio/static/css/styles.css"
      media="print"
      onload="this.media='all'; this.onload=null;"
    />

    <link
      rel="preconnect"
      href="https://api.websitecarbon.com"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="styles.css"
      media="print"
      onload="this.media='all'; this.onload=null;"
    />
    <noscript><link rel="stylesheet" href="styles.css" /></noscript>

    <link
      rel="stylesheet"
      href="tln.css"
      media="print"
      onload="this.media='all'; this.onload=null;"
    />
    <noscript><link rel="stylesheet" href="tln.css" /></noscript>

    <script type="module">
      /**
       * Pressing the TAB key in a text area makes it lose focus and move to the next component, but
       * if we want people to write code, then they'll possibly use a TAB. So, let's enable it selectively.
       */
      const enableTab = async (id) => {
        const element = document.getElementById(id);
        element.onkeydown = (event) => {
          const key = event.keyCode
            ? event.keyCode
            : event.charCode
            ? event.charCode
            : event.which;

          // Tab key code is 9
          if (key != 9 || event.shiftKey || event.ctrlKey || event.altKey) {
            return true;
          }

          const scrollTop = element.scrollTop;
          if (element.setSelectionRange) {
            const selectionStart = element.selectionStart;
            const selectionEnd = element.selectionEnd;
            element.value =
              element.value.substring(0, selectionStart) +
              "\t" +
              element.value.substr(selectionEnd);
            element.setSelectionRange(selectionStart + 1, selectionStart + 1);
            element.focus();
          } else if (element.createTextRange) {
            document.selection.createRange().text = "\t";
            event.returnValue = false;
          }

          element.scrollTop = scrollTop;

          if (event.preventDefault) {
            event.preventDefault();
          }

          return false;
        };
      };

      const TLN = {
        eventList: {},
        update_line_numbers: async (e, t) => {
          let n = e.value.split("\n").length - t.children.length;
          if (n > 0) {
            const e = document.createDocumentFragment();
            for (; n > 0; ) {
              const t = document.createElement("span");
              (t.className = "tln-line"), e.appendChild(t), (n -= 1);
            }
            t.appendChild(e);
          }
          for (; n < 0; ) {
            t.removeChild(t.lastChild), (n += 1);
          }
        },
        append_line_numbers: async (e) => {
          const t = document.getElementById(e);
          if (null == t) {
            return console.warn(
              "[tln.js] Couldn't find textarea of id '" + e + "'"
            );
          }
          const n = document.createElement("div");
          (n.className = "tln-wrapper"),
            t.parentNode.insertBefore(n, t),
            TLN.update_line_numbers(t, n),
            (TLN.eventList[e] = []);
          const l = ["propertychange", "input", "keydown", "keyup"],
            o = (function (e, t) {
              return function (n) {
                ((10 != +e.scrollLeft ||
                  (37 != n.keyCode &&
                    37 != n.which &&
                    "ArrowLeft" != n.code &&
                    "ArrowLeft" != n.key)) &&
                  36 != n.keyCode &&
                  36 != n.which &&
                  "Home" != n.code &&
                  "Home" != n.key &&
                  13 != n.keyCode &&
                  13 != n.which &&
                  "Enter" != n.code &&
                  "Enter" != n.key &&
                  "NumpadEnter" != n.code) ||
                  (e.scrollLeft = 0),
                  TLN.update_line_numbers(e, t);
              };
            })(t, n);
          for (let n = l.length - 1; n >= 0; n -= 1) {
            t.addEventListener(l[n], o, { passive: !0 }),
              TLN.eventList[e].push({ evt: l[n], hdlr: o });
          }
          const r = ["change", "mousewheel", "scroll"],
            s = (function (e, t) {
              return function () {
                t.scrollTop = e.scrollTop;
              };
            })(t, n);
          for (let n = r.length - 1; n >= 0; n -= 1) {
            t.addEventListener(r[n], s, { passive: !0 }),
              TLN.eventList[e].push({ evt: r[n], hdlr: s });
          }
        },
      };

      // Lazy load some stuff
      import("./lce.js").then((module) =>
        module.default().then(() => {
          enableTab("code-area");
          TLN.append_line_numbers("code-area");
        })
      );
    </script>
  </head>
  <body></body>
</html>
